<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>‡∏ó‡∏≤‡∏¢‡∏ú‡∏•‡∏ö‡∏≠‡∏• | ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</title>
<meta name="color-scheme" content="dark"/>
<style>
/* (‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏° + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å) */
:root{
  --bg0:#060102; --bg1:#0b0304;
  --line:rgba(255,90,90,.22);
  --line2:rgba(255,90,90,.32);
  --txt:#fff1f1;
  --muted:rgba(255,210,210,.75);
  --muted2:rgba(255,210,210,.55);
  --accent:#ff2b2b; --accent2:#b80000;
  --ok:#36d399; --bad:#ff5a5f; --warn:#ffcc66;
  --shadow:0 22px 70px rgba(0,0,0,.65);
  --shadow2:0 12px 40px rgba(0,0,0,.45);
  --r14:14px; --r16:16px; --r20:20px;
}
*{box-sizing:border-box}
body{
  margin:0;padding:18px 14px 30px;
  font-family:system-ui,-apple-system,"Segoe UI",Tahoma,sans-serif;
  color:var(--txt);
  background:
    radial-gradient(1000px 600px at 15% 10%, rgba(255,0,0,.20), transparent 60%),
    radial-gradient(900px 540px at 85% 18%, rgba(255,0,0,.12), transparent 60%),
    radial-gradient(900px 600px at 50% 120%, rgba(255,0,0,.10), transparent 55%),
    linear-gradient(180deg, var(--bg0), var(--bg1));
  overflow-x:hidden;
}
.wrap{width:min(980px,100%);margin:0 auto}
.topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px}
.brand{display:flex;align-items:center;gap:12px}
.brand .logo{
  width:44px;height:44px;border-radius:14px;
  background:rgba(255,255,255,.06);
  border:1px solid var(--line2);
  display:grid;place-items:center;overflow:hidden;
  box-shadow:var(--shadow2);
}
.brand .logo img{width:100%;height:100%;object-fit:cover}
.brand .t b{font-size:14px}
.brand .t span{display:block;font-size:12px;color:var(--muted2)}
.chip{
  display:inline-flex;align-items:center;gap:8px;
  padding:10px 12px;border-radius:999px;
  border:1px solid var(--line2);
  background:rgba(0,0,0,.18);
  box-shadow:var(--shadow2);
  font-size:12px;color:var(--muted);
  user-select:none;white-space:nowrap;
}
.dot{width:8px;height:8px;border-radius:99px;background:var(--ok);box-shadow:0 0 18px rgba(54,211,153,.65)}
.dot.warn{background:var(--warn);box-shadow:0 0 18px rgba(255,204,102,.6)}
.dot.bad{background:var(--bad);box-shadow:0 0 18px rgba(255,90,90,.6)}
.card{
  border-radius:var(--r20);
  background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
  border:1px solid var(--line);
  box-shadow:var(--shadow);
  overflow:hidden;
  backdrop-filter:blur(10px);
}
.head{
  padding:18px;border-bottom:1px solid var(--line);
  background:
    radial-gradient(700px 260px at 50% 0%, rgba(255,43,43,.22), transparent 65%),
    linear-gradient(180deg, rgba(0,0,0,.22), transparent);
  text-align:center;
}
.heroLogo{display:flex;justify-content:center;margin-bottom:12px}
.heroLogo .pill{
  padding:12px 16px;border-radius:999px;
  border:1px solid rgba(255,90,90,.28);
  background:rgba(0,0,0,.18);
  box-shadow:0 14px 40px rgba(0,0,0,.45);
}
.heroLogo img{width:170px;max-width:78vw;height:auto;display:block;filter:drop-shadow(0 0 18px rgba(255,0,0,.45))}
.title{margin:0;font-weight:1000;font-size:26px}
.sub{margin-top:8px;font-size:13px;color:var(--muted);line-height:1.55}
.matchBar{
  margin-top:14px;
  border-radius:var(--r16);
  border:1px solid rgba(255,90,90,.24);
  background:rgba(0,0,0,.22);
  padding:14px;
}
.teams{display:grid;grid-template-columns:1fr auto 1fr;gap:14px;align-items:center}
.badge{
  width:96px;height:96px;border-radius:20px;margin:0 auto;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,90,90,.28);
  box-shadow:0 14px 40px rgba(0,0,0,.45);
  display:grid;place-items:center;aspect-ratio:1/1;overflow:hidden;
}
.badge img{
  width:100%;height:100%;
  object-fit:contain;object-position:center;
  max-width:72%;max-height:72%;
  display:block;transform:translateY(2px);
}
.teamName{margin-top:8px;font-size:12px;text-align:center;color:rgba(255,235,235,.92)}
.vs{font-weight:1100;letter-spacing:2px;font-size:18px;color:rgba(255,200,200,.88);user-select:none}
.body{padding:18px}
.row{margin-bottom:14px}
.label{display:flex;align-items:center;justify-content:space-between;gap:10px;color:var(--muted);font-size:13px;margin-bottom:8px}
.mini{font-size:11px;color:rgba(255,210,210,.55)}
.input{
  width:100%;padding:13px;border-radius:var(--r14);
  border:1px solid rgba(255,90,90,.22);
  background:rgba(0,0,0,.24);
  color:var(--txt);outline:none;font-size:14px;transition:.2s ease;
}
.input:focus{border-color:rgba(255,43,43,.85);box-shadow:0 0 0 4px rgba(255,43,43,.22)}
.input::placeholder{color:rgba(255,210,210,.42)}
.btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.btn{cursor:pointer;border:none;border-radius:var(--r14);padding:12px 14px;font-weight:950;font-size:14px;transition:.18s ease;user-select:none}
.btn:active{transform:translateY(1px) scale(.99)}
.btn[disabled]{opacity:.55;cursor:not-allowed;transform:none}
.btnGhost{background:rgba(255,255,255,.06);color:var(--txt);border:1px solid rgba(255,90,90,.18)}
.btnPrimary{flex:1;min-width:240px;color:#fff;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 18px 40px rgba(255,43,43,.15)}
.btnDanger{background:linear-gradient(135deg,#ff8a8f,#ff2b2b);color:#1f0b0c}
.scoreBox{
  display:grid;grid-template-columns:1fr auto 1fr;gap:10px;align-items:center;
  padding:12px;border-radius:var(--r16);
  border:1px dashed rgba(255,90,90,.35);
  background:rgba(0,0,0,.22);
}
.scoreCtrl{display:flex;align-items:center;gap:8px;justify-content:center}
.scoreInput{
  width:66px;text-align:center;font-size:22px;font-weight:1000;
  padding:10px 0;border-radius:var(--r14);
  border:1px solid rgba(255,90,90,.35);
  background:rgba(0,0,0,.35);color:#fff;
}
.scBtn{
  width:44px;height:44px;border-radius:var(--r14);
  border:1px solid rgba(255,90,90,.22);
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#fff;font-size:22px;font-weight:1000;
  cursor:pointer;box-shadow:0 8px 20px rgba(255,0,0,.35);
}
.scBtn:active{transform:scale(.95)}
.scBtn[disabled]{opacity:.55;cursor:not-allowed;transform:none}
.hint{margin-top:10px;font-size:12px;color:rgba(255,220,220,.62);line-height:1.45}

.choiceGrid{
  display:grid;grid-template-columns:1fr 1fr;gap:10px;
  padding:12px;border-radius:var(--r16);
  border:1px dashed rgba(255,90,90,.35);
  background:rgba(0,0,0,.22);
}
.choice3{grid-template-columns:1fr 1fr 1fr}
.choiceBtn{
  border:1px solid rgba(255,90,90,.22);
  background:rgba(255,255,255,.06);
  color:var(--txt);
  padding:12px 10px;border-radius:var(--r14);
  cursor:pointer;font-weight:900;font-size:13px;
  display:flex;align-items:center;justify-content:center;gap:8px;
  transition:.15s ease;
}
.choiceBtn:active{transform:scale(.99)}
.choiceBtn.active{
  border-color:rgba(54,211,153,.55);
  box-shadow:0 0 0 4px rgba(54,211,153,.14);
  background:rgba(54,211,153,.10);
}
.alert{margin-top:12px;padding:12px;border-radius:var(--r16);border:1px solid rgba(255,90,90,.18);background:rgba(0,0,0,.18);font-size:13px;line-height:1.55}
.ok{border-color:rgba(54,211,153,.28);background:rgba(54,211,153,.10)}
.err{border-color:rgba(255,90,90,.30);background:rgba(255,90,90,.10)}
.warn{border-color:rgba(255,204,102,.35);background:rgba(255,204,102,.12)}
.spin{width:16px;height:16px;border-radius:99px;border:2px solid rgba(255,255,255,.25);border-top-color: rgba(255,255,255,.95);display:inline-block; animation:rot .7s linear infinite;vertical-align:-3px;margin-right:8px}
@keyframes rot{to{transform:rotate(360deg)}}
</style>
</head>

<body>
<div class="wrap">
  <div class="topbar">
    <div class="brand">
      <div class="logo"><img src="https://ramruay365.co/wp-content/uploads/2025/12/1735020594-1.png" alt="RR365"></div>
      <div class="t"><b>Rumruay365</b><span>‡∏ó‡∏≤‡∏¢‡∏ú‡∏•‡∏ö‡∏≠‡∏• ‚Ä¢ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡∏ä‡∏µ‡∏ó</span></div>
    </div>
    <div class="chip"><span id="dot" class="dot warn"></span><span id="rrStatus">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡πá‡∏Ñ</span></div>
  </div>

  <section class="card">
    <div class="head">
      <div class="heroLogo"><div class="pill"><img src="https://ramruay365.co/wp-content/uploads/2025/12/1735020594-1.png" alt="‡∏£‡πà‡∏≥‡∏£‡∏ß‡∏¢365"></div></div>
      <h2 class="title">‡∏ó‡∏≤‡∏¢‡∏ú‡∏•‡∏ö‡∏≠‡∏• (‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥)</h2>
      <div class="sub">
        ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô: ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå ‚Üí ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå/‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‚Üí ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡∏ä‡∏µ‡∏ó ‚Üí ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏ó‡∏≤‡∏¢‡πÑ‡∏î‡πâ<br>
        ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ó‡∏≤‡∏¢: ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ 23:59 ‡∏ô.
      </div>

      <div class="matchBar">
        <div class="teams">
          <div>
            <div class="badge"><img id="homeLogo" alt="‡∏ó‡∏µ‡∏°‡πÄ‡∏´‡∏¢‡πâ‡∏≤"></div>
            <div class="teamName" id="homeName">‡∏™‡πÄ‡∏õ‡∏≠‡∏£‡πå‡∏™</div>
          </div>
          <div class="vs">VS</div>
          <div>
            <div class="badge"><img id="awayLogo" alt="‡∏ó‡∏µ‡∏°‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô"></div>
            <div class="teamName" id="awayName">‡∏•‡∏¥‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏û‡∏π‡∏•</div>
          </div>
        </div>
        <div class="hint" style="margin-top:10px">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <b id="stText">NONE</b></div>
      </div>
    </div>

    <div class="body">
      <form id="f" autocomplete="off">
        <div class="row">
          <div class="label"><span>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</span><span class="mini">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á: <b id="devMini">‚Äî</b></span></div>
          <input class="input" id="user" type="tel" inputmode="numeric" autocomplete="tel"
                 placeholder="‡πÄ‡∏ä‡πà‡∏ô 096xxxxxxx" maxlength="12" required>

          <div class="btns">
            <button type="button" class="btn btnGhost" id="btnReq">üßæ ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)</button>
            <button type="button" class="btn btnGhost" id="btnStatus">üîÑ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
            <button type="reset"  class="btn btnGhost">‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤</button>
            <button type="button" class="btn btnDanger" id="btnUnlock">üßπ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ</button>
          </div>
          <div class="hint">* 1 ‡∏Ñ‡∏ô / 1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏à‡∏∞ BLOCKED)</div>
        </div>

        <!-- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡∏ó‡∏µ‡∏°‡πÑ‡∏´‡∏ô‡πÄ‡∏Ç‡∏µ‡πà‡∏¢‡∏Å‡πà‡∏≠‡∏ô -->
        <div class="row">
          <div class="label"><span>‡∏ó‡∏µ‡∏°‡πÑ‡∏´‡∏ô‡πÄ‡∏Ç‡∏µ‡πà‡∏¢‡∏Å‡πà‡∏≠‡∏ô</span><span class="mini">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1 ‡∏ó‡∏µ‡∏°</span></div>
          <div class="choiceGrid" id="kickGrid">
            <button type="button" class="choiceBtn" data-kick="HOME" id="kickHome">üèÅ <span id="kickHomeTxt">‡∏™‡πÄ‡∏õ‡∏≠‡∏£‡πå‡∏™</span></button>
            <button type="button" class="choiceBtn" data-kick="AWAY" id="kickAway">üèÅ <span id="kickAwayTxt">‡∏•‡∏¥‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏û‡∏π‡∏•</span></button>
          </div>
          <div class="hint">* ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ó‡∏≤‡∏¢‡πÑ‡∏î‡πâ</div>
        </div>

        <!-- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡∏ó‡∏µ‡∏°‡πÑ‡∏´‡∏ô‡∏¢‡∏¥‡∏á‡∏Å‡πà‡∏≠‡∏ô -->
        <div class="row">
          <div class="label"><span>‡∏ó‡∏µ‡∏°‡πÑ‡∏´‡∏ô‡∏¢‡∏¥‡∏á‡∏Å‡πà‡∏≠‡∏ô</span><span class="mini">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span></div>
          <div class="choiceGrid choice3" id="firstGrid">
            <button type="button" class="choiceBtn" data-first="HOME" id="firstHome">‚öΩ <span id="firstHomeTxt">‡∏™‡πÄ‡∏õ‡∏≠‡∏£‡πå‡∏™</span></button>
            <button type="button" class="choiceBtn" data-first="AWAY" id="firstAway">‚öΩ <span id="firstAwayTxt">‡∏•‡∏¥‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏û‡∏π‡∏•</span></button>
            <button type="button" class="choiceBtn" data-first="NONE" id="firstNone">üö´ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ï‡∏π</button>
          </div>
          <div class="hint">* ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤ 0-0 ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äú‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ï‡∏π‚Äù ‡πÑ‡∏î‡πâ</div>
        </div>

        <!-- ‡∏™‡∏Å‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏¥‡∏° -->
        <div class="row">
          <div class="label"><span>‡∏ó‡∏≤‡∏¢‡∏™‡∏Å‡∏≠‡∏£‡πå (‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç)</span><span class="mini">‡∏ó‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</span></div>
          <div class="scoreBox">
            <div class="scoreCtrl">
              <button type="button" class="scBtn" id="hsMinus">‚àí</button>
              <input class="scoreInput" id="hs" type="number" value="0" min="0" max="99" readonly disabled>
              <button type="button" class="scBtn" id="hsPlus">+</button>
            </div>
            <div class="vs" style="font-size:16px">VS</div>
            <div class="scoreCtrl">
              <button type="button" class="scBtn" id="asMinus">‚àí</button>
              <input class="scoreInput" id="as" type="number" value="0" min="0" max="99" readonly disabled>
              <button type="button" class="scBtn" id="asPlus">+</button>
            </div>
          </div>
          <div class="btns">
            <button class="btn btnPrimary" id="btnSend" type="submit" disabled>‚õî ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
          </div>
        </div>

        <div id="msg"></div>
      </form>
    </div>
  </section>
</div>

<script>
/* ================== CONFIG ================== */
const WEB_APP_URL = "‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå Web App ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ"; // /exec
const HOME_NAME = "‡∏™‡πÄ‡∏õ‡∏≠‡∏£‡πå‡∏™";
const AWAY_NAME = "‡∏•‡∏¥‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏û‡∏π‡∏•";
const HOME_LOGO = "https://media.api-sports.io/football/teams/47.png";
const AWAY_LOGO = "https://media.api-sports.io/football/teams/40.png";
/* =========================================== */

const $ = (id)=>document.getElementById(id);

function setTop(type, text){
  $("rrStatus").textContent = text;
  $("dot").className = "dot" + (type==="ok" ? "" : type==="bad" ? " bad" : " warn");
}
function showMsg(type, text){
  const cls = type==="ok" ? "alert ok" : type==="warn" ? "alert warn" : "alert err";
  $("msg").innerHTML = `<div class="${cls}">${text}</div>`;
}
function onlyDigits(s){ return String(s||"").replace(/[^\d]/g,""); }
function isValidPhone(d){ return /^0\d{8,9}$/.test(d); }

function getDeviceId(){
  const key="RR365_DEVICE_ID";
  let v=localStorage.getItem(key);
  if(!v){
    v=(crypto && crypto.randomUUID) ? crypto.randomUUID()
      : ("dev_"+Math.random().toString(16).slice(2)+Date.now());
    localStorage.setItem(key,v);
  }
  return v;
}
const deviceId = getDeviceId();
$("devMini").textContent = deviceId.slice(0,8)+"‚Ä¶";

const LS_USER = "RR365_LAST_USER_" + deviceId;
const LS_ST   = "RR365_LAST_STATUS_" + deviceId;

const LS_KICK = "RR365_KICK_" + deviceId;   // HOME/AWAY
const LS_FIRST= "RR365_FIRST_" + deviceId;  // HOME/AWAY/NONE

function lockScore(disabled){
  $("hs").disabled = disabled;
  $("as").disabled = disabled;
  $("hsMinus").disabled = disabled;
  $("hsPlus").disabled  = disabled;
  $("asMinus").disabled = disabled;
  $("asPlus").disabled  = disabled;
}

function setChoiceActive(groupEl, key, value){
  [...groupEl.querySelectorAll(".choiceBtn")].forEach(b=>{
    const v = b.dataset[key];
    b.classList.toggle("active", v === value);
  });
}

function getKick(){ return localStorage.getItem(LS_KICK) || ""; }
function getFirst(){ return localStorage.getItem(LS_FIRST) || ""; }
function setKick(v){ localStorage.setItem(LS_KICK, v); setChoiceActive($("kickGrid"), "kick", v); }
function setFirst(v){ localStorage.setItem(LS_FIRST, v); setChoiceActive($("firstGrid"), "first", v); }

function canSubmitNow(){
  const st = $("stText").textContent;
  if(st !== "APPROVED") return false;
  const kick = getKick();
  const first = getFirst();
  if(!(kick==="HOME" || kick==="AWAY")) return false;
  if(!(first==="HOME" || first==="AWAY" || first==="NONE")) return false;
  return true;
}

function refreshSubmitBtn(){
  if($("stText").textContent==="APPROVED"){
    lockScore(false);
    $("btnSend").disabled = !canSubmitNow();
    $("btnSend").textContent = canSubmitNow() ? "‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ó‡∏≤‡∏¢" : "‚ö†Ô∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ç‡∏µ‡πà‡∏¢‡∏Å‡πà‡∏≠‡∏ô/‡∏¢‡∏¥‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö";
    setTop("ok","‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß");
    $("btnReq").disabled=true;
    $("btnReq").textContent="‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß";
    return;
  }
  $("btnSend").disabled = true;
  $("btnSend").textContent = "‚õî ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥";
}

function setStatus(st){
  st = String(st||"NONE").toUpperCase();
  $("stText").textContent = st;
  localStorage.setItem(LS_ST, st);

  $("btnReq").disabled=false;
  $("btnReq").textContent="üßæ ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)";
  $("btnStatus").disabled=false;
  $("user").disabled=false;

  if(st==="APPROVED"){
    $("btnReq").disabled=true;
    $("btnReq").textContent="‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß";
    refreshSubmitBtn();
    return;
  }
  lockScore(true);
  $("btnSend").disabled=true;
  $("btnSend").textContent="‚õî ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥";

  if(st==="PENDING"){
    $("btnReq").disabled=true;
    $("btnReq").textContent="üßæ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡πâ‡∏ß (‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á‡∏ã‡πâ‡∏≥)";
    setTop("warn","‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡∏ä‡∏µ‡∏ó");
    return;
  }
  if(st==="USED"){
    $("btnSend").disabled=true; $("btnSend").textContent="‚úÖ ‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏•‡πâ‡∏ß";
    $("btnReq").disabled=true; $("btnStatus").disabled=true; $("user").disabled=true;
    setTop("ok","‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏•‡πâ‡∏ß");
    return;
  }
  if(st==="BLOCKED"){ $("btnReq").disabled=true; $("btnReq").textContent="‚õî ‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å"; setTop("bad","‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å"); return; }
  if(st==="REJECTED"){ $("btnReq").disabled=true; $("btnReq").textContent="‚õî ‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò"; setTop("bad","‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò"); return; }

  setTop("warn","‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
}

async function post(body){
  const res = await fetch(WEB_APP_URL, {
    method:"POST",
    headers: {"Content-Type":"text/plain;charset=utf-8"},
    body: JSON.stringify(body)
  });
  const t = await res.text();
  return JSON.parse(t);
}

function setLoading(btn, on, text){
  if(on){
    btn.dataset.prev = btn.textContent;
    btn.disabled = true;
    btn.innerHTML = `<span class="spin"></span>${text || "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£..."}`;
  }else{
    btn.disabled = false;
    btn.textContent = btn.dataset.prev || btn.textContent;
  }
}

function getPhone(){
  const d = onlyDigits($("user").value);
  $("user").value = d.slice(0,10);
  return $("user").value;
}

/* init team names */
$("homeName").textContent = HOME_NAME;
$("awayName").textContent = AWAY_NAME;
$("kickHomeTxt").textContent = HOME_NAME;
$("kickAwayTxt").textContent = AWAY_NAME;
$("firstHomeTxt").textContent = HOME_NAME;
$("firstAwayTxt").textContent = AWAY_NAME;

/* logos */
$("homeLogo").src = HOME_LOGO;
$("awayLogo").src = AWAY_LOGO;
$("homeLogo").onerror=function(){this.onerror=null; this.src="https://ramruay365.co/wp-content/uploads/2025/12/1735020594-1.png";}
$("awayLogo").onerror=function(){this.onerror=null; this.src="https://ramruay365.co/wp-content/uploads/2025/12/1735020594-1.png";}

function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
function changeScore(id, step){
  const el=$(id);
  if(el.disabled) return;
  const min=Number(el.min||0), max=Number(el.max||99);
  let v=parseInt(el.value||"0",10);
  if(Number.isNaN(v)) v=0;
  el.value=String(clamp(v+step,min,max));
}
$("hsMinus").addEventListener("click", ()=>changeScore("hs",-1));
$("hsPlus").addEventListener("click",  ()=>changeScore("hs", 1));
$("asMinus").addEventListener("click", ()=>changeScore("as",-1));
$("asPlus").addEventListener("click",  ()=>changeScore("as", 1));

/* choices */
$("kickGrid").addEventListener("click", (e)=>{
  const b = e.target.closest(".choiceBtn");
  if(!b) return;
  setKick(b.dataset.kick);
  refreshSubmitBtn();
});
$("firstGrid").addEventListener("click", (e)=>{
  const b = e.target.closest(".choiceBtn");
  if(!b) return;
  setFirst(b.dataset.first);
  refreshSubmitBtn();
});

/* load saved */
(function init(){
  const lastUser = localStorage.getItem(LS_USER) || "";
  if(lastUser) $("user").value = lastUser;

  const kick = getKick(); if(kick) setKick(kick);
  const first = getFirst(); if(first) setFirst(first);

  setStatus(localStorage.getItem(LS_ST) || "NONE");
  refreshSubmitBtn();
})();

/* buttons */
$("btnReq").addEventListener("click", async ()=>{
  const phone = getPhone();
  if(!isValidPhone(phone)) return showMsg("err","‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô 096xxxxxxx)");
  if(!WEB_APP_URL || WEB_APP_URL.includes("‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå")) return showMsg("err","‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà WEB_APP_URL");

  setLoading($("btnReq"), true, "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠...");
  try{
    const data = await post({action:"request", username: phone, deviceId, userAgent:navigator.userAgent});
    localStorage.setItem(LS_USER, phone);

    if(data.ok){ showMsg("ok", data.msg || "‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); setStatus(data.status || "PENDING"); }
    else { showMsg("warn", data.msg || "‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); setStatus(data.status || "NONE"); }
    refreshSubmitBtn();
  }catch(e){
    showMsg("err","‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Web App / Deploy / ‡πÄ‡∏ô‡πá‡∏ï");
    setTop("bad","‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ");
  }finally{
    if($("stText").textContent==="NONE"){
      setLoading($("btnReq"), false);
      $("btnReq").textContent="üßæ ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)";
    }
  }
});

$("btnStatus").addEventListener("click", async ()=>{
  const phone = getPhone();
  if(!isValidPhone(phone)) return showMsg("err","‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô 096xxxxxxx)");
  if(!WEB_APP_URL || WEB_APP_URL.includes("‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå")) return showMsg("err","‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà WEB_APP_URL");

  setLoading($("btnStatus"), true, "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡πá‡∏Ñ...");
  try{
    const data = await post({action:"status", username: phone, deviceId, userAgent:navigator.userAgent});
    localStorage.setItem(LS_USER, phone);

    if(data.ok){ showMsg("ok", data.msg || "‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); setStatus(data.status || "APPROVED"); }
    else { showMsg("warn", data.msg || "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"); setStatus(data.status || "PENDING"); } // auto-create -> PENDING
    refreshSubmitBtn();
  }catch(e){
    showMsg("err","‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    setTop("bad","‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ");
  }finally{
    setLoading($("btnStatus"), false);
    $("btnStatus").textContent="üîÑ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞";
  }
});

$("f").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const phone = getPhone();
  if(!isValidPhone(phone)) return showMsg("err","‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô 096xxxxxxx)");
  if(!WEB_APP_URL || WEB_APP_URL.includes("‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå")) return showMsg("err","‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà WEB_APP_URL");
  if(!canSubmitNow()) return showMsg("warn","‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äú‡πÄ‡∏Ç‡∏µ‡πà‡∏¢‡∏Å‡πà‡∏≠‡∏ô‚Äù ‡πÅ‡∏•‡∏∞ ‚Äú‡∏¢‡∏¥‡∏á‡∏Å‡πà‡∏≠‡∏ô‚Äù ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á");

  setLoading($("btnSend"), true, "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...");
  try{
    const data = await post({
      action:"submit",
      username: phone,
      deviceId,
      homeScore: $("hs").value,
      awayScore: $("as").value,
      kickOffTeam: getKick(),      // HOME/AWAY
      firstGoalTeam: getFirst(),   // HOME/AWAY/NONE
      userAgent: navigator.userAgent
    });

    if(data.ok){
      showMsg("ok", data.msg || "‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ó‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      setStatus("USED");
    }else{
      showMsg("err", data.msg || "‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      setStatus(data.status || $("stText").textContent);
    }
    refreshSubmitBtn();
  }catch(e){
    showMsg("err","‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Web App / Deploy / ‡πÄ‡∏ô‡πá‡∏ï");
    setTop("bad","‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  }finally{
    if($("stText").textContent==="APPROVED"){
      setLoading($("btnSend"), false);
      refreshSubmitBtn();
    }
  }
});

$("btnUnlock").addEventListener("click", ()=>{
  if(!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ?")) return;
  localStorage.removeItem(LS_USER);
  localStorage.removeItem(LS_ST);
  localStorage.removeItem(LS_KICK);
  localStorage.removeItem(LS_FIRST);
  $("user").disabled=false;
  $("btnStatus").disabled=false;
  $("user").value="";
  $("hs").value="0";
  $("as").value="0";
  $("msg").innerHTML="";
  setStatus("NONE");
  showMsg("ok","‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
  refreshSubmitBtn();
});
</script>
</body>
</html>
