<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>‡∏ó‡∏≤‡∏¢‡∏ú‡∏•‡∏ö‡∏≠‡∏• | ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</title>
<meta name="color-scheme" content="dark"/>

<style>
  :root{
    --bg0:#060102;
    --bg1:#0b0304;
    --line:rgba(255,90,90,.22);
    --line2:rgba(255,90,90,.32);
    --txt:#fff1f1;
    --muted:rgba(255,210,210,.75);
    --muted2:rgba(255,210,210,.55);
    --accent:#ff2b2b;
    --accent2:#b80000;
    --ok:#36d399;
    --bad:#ff5a5f;
    --shadow:0 22px 70px rgba(0,0,0,.65);
    --shadow2:0 12px 40px rgba(0,0,0,.45);
    --r14:14px; --r16:16px; --r20:20px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    padding:18px 14px 30px;
    font-family:system-ui,-apple-system,"Segoe UI",Tahoma,sans-serif;
    color:var(--txt);
    background:
      radial-gradient(1000px 600px at 15% 10%, rgba(255,0,0,.20), transparent 60%),
      radial-gradient(900px 540px at 85% 18%, rgba(255,0,0,.12), transparent 60%),
      radial-gradient(900px 600px at 50% 120%, rgba(255,0,0,.10), transparent 55%),
      linear-gradient(180deg, var(--bg0), var(--bg1));
    overflow-x:hidden;
  }

  .wrap{width:min(980px,100%);margin:0 auto;position:relative}

  .topbar{
    display:flex;align-items:center;justify-content:space-between;gap:12px;
    margin-bottom:14px;
  }
  .brand{display:flex;align-items:center;gap:12px}
  .brand .logo{
    width:44px;height:44px;border-radius:14px;
    background:rgba(255,255,255,.06);
    border:1px solid var(--line2);
    display:grid;place-items:center;
    box-shadow:var(--shadow2);
    overflow:hidden;
  }
  .brand .logo img{width:100%;height:100%;object-fit:cover}
  .brand .t{line-height:1.2}
  .brand .t b{font-size:14px;letter-spacing:.2px}
  .brand .t span{display:block;font-size:12px;color:var(--muted2)}

  .chip{
    display:inline-flex;align-items:center;gap:8px;
    padding:10px 12px;border-radius:999px;
    border:1px solid var(--line2);
    background:rgba(0,0,0,.18);
    box-shadow:var(--shadow2);
    font-size:12px;color:var(--muted);
    user-select:none;white-space:nowrap;
  }
  .dot{width:8px;height:8px;border-radius:99px;background:var(--ok);box-shadow:0 0 18px rgba(54,211,153,.65)}

  .card{
    border-radius:var(--r20);
    background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
    border:1px solid var(--line);
    box-shadow:var(--shadow);
    overflow:hidden;
    backdrop-filter:blur(10px);
  }
  .head{
    padding:18px;
    border-bottom:1px solid var(--line);
    background:
      radial-gradient(700px 260px at 50% 0%, rgba(255,43,43,.22), transparent 65%),
      linear-gradient(180deg, rgba(0,0,0,.22), transparent);
    text-align:center;
  }

  .heroLogo{display:flex;justify-content:center;margin-bottom:12px}
  .heroLogo .pill{
    padding:12px 16px;border-radius:999px;
    border:1px solid rgba(255,90,90,.28);
    background:rgba(0,0,0,.18);
    box-shadow:0 14px 40px rgba(0,0,0,.45);
  }
  .heroLogo img{
    width:170px;max-width:78vw;height:auto;display:block;
    filter:drop-shadow(0 0 18px rgba(255,0,0,.45));
  }

  .title{margin:0;font-weight:1000;font-size:26px;letter-spacing:.2px}
  .sub{margin-top:8px;font-size:13px;color:var(--muted);line-height:1.55}

  .matchBar{
    margin-top:14px;
    border-radius:var(--r16);
    border:1px solid rgba(255,90,90,.24);
    background:rgba(0,0,0,.22);
    padding:14px;
  }
  .teams{
    display:grid;
    grid-template-columns:1fr auto 1fr;
    gap:14px;
    align-items:center;
  }

  .badge{
    width:96px;height:96px;border-radius:20px;
    margin:0 auto;
    background:rgba(255,255,255,.05);
    border:1px solid rgba(255,90,90,.28);
    box-shadow:0 14px 40px rgba(0,0,0,.45);
    display:grid;place-items:center;
    aspect-ratio:1/1;
    overflow:hidden;
  }
  .badge img{
    width:100%;height:100%;
    object-fit:contain;object-position:center;
    max-width:66%;max-height:66%;
    transform:translateY(2px);
    filter:none;
    display:block;
  }
  .teamName{
    margin-top:8px;font-size:12px;color:rgba(255,235,235,.92);
    text-align:center;
    max-width:260px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  }
  .vs{font-weight:1100;letter-spacing:2px;font-size:18px;color:rgba(255,200,200,.88);user-select:none;text-shadow:0 0 18px rgba(255,0,0,.35)}

  .body{padding:18px}
  .row{margin-bottom:14px}
  .label{
    display:flex;align-items:center;justify-content:space-between;gap:10px;
    color:var(--muted);font-size:13px;margin-bottom:8px;
  }
  .mini{font-size:11px;color:rgba(255,210,210,.55)}

  .input{
    width:100%;
    padding:13px;
    border-radius:var(--r14);
    border:1px solid rgba(255,90,90,.22);
    background:rgba(0,0,0,.24);
    color:var(--txt);
    outline:none;
    font-size:14px;
    transition:.2s ease;
  }
  .input::placeholder{color:rgba(255,210,210,.42)}
  .input:focus{border-color:rgba(255,43,43,.85);box-shadow:0 0 0 4px rgba(255,43,43,.22)}

  /* ‚úÖ FIX: ‡∏Å‡∏±‡∏ô WP/‡∏ò‡∏µ‡∏°‡∏ó‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å */
  #user{
    position:relative;
    z-index:9999;
    pointer-events:auto !important;
    user-select:text !important;
    -webkit-user-select:text !important;
    touch-action:manipulation;
  }

  .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .btn{
    cursor:pointer;
    border:none;
    border-radius:var(--r14);
    padding:12px 14px;
    font-weight:950;
    letter-spacing:.2px;
    font-size:14px;
    transition:.18s ease;
    user-select:none;
  }
  .btn:active{transform:translateY(1px) scale(.99)}
  .btn[disabled]{opacity:.55;cursor:not-allowed;transform:none}
  .btnGhost{
    background:rgba(255,255,255,.06);
    color:var(--txt);
    border:1px solid rgba(255,90,90,.18);
  }
  .btnPrimary{
    flex:1;min-width:240px;color:#fff;
    background:linear-gradient(135deg,var(--accent),var(--accent2));
    box-shadow:0 18px 40px rgba(255,43,43,.15);
  }

  .scoreBox{
    display:grid;
    grid-template-columns:1fr auto 1fr;
    gap:10px;
    align-items:center;
    padding:12px;
    border-radius:var(--r16);
    border:1px dashed rgba(255,90,90,.35);
    background:rgba(0,0,0,.22);
  }

  .scoreCtrl{display:flex;align-items:center;gap:8px;justify-content:center}
  .scoreInput{
    width:66px;
    text-align:center;
    font-size:22px;
    font-weight:1000;
    padding:10px 0;
    border-radius:var(--r14);
    border:1px solid rgba(255,90,90,.35);
    background:rgba(0,0,0,.35);
    color:#fff;
  }
  .scBtn{
    width:44px;height:44px;border-radius:var(--r14);
    border:1px solid rgba(255,90,90,.22);
    background:linear-gradient(135deg,var(--accent),var(--accent2));
    color:#fff;font-size:22px;font-weight:1000;
    cursor:pointer;
    box-shadow:0 8px 20px rgba(255,0,0,.35);
  }
  .scBtn:active{transform:scale(.95)}
  .scBtn[disabled]{opacity:.55;cursor:not-allowed;transform:none}

  .hint{margin-top:10px;font-size:12px;color:rgba(255,220,220,.62);line-height:1.45}

  .alert{
    margin-top:12px;
    padding:12px;
    border-radius:var(--r16);
    border:1px solid rgba(255,90,90,.18);
    background:rgba(0,0,0,.18);
    font-size:13px;
    line-height:1.55;
  }
  .ok{border-color:rgba(54,211,153,.28);background:rgba(54,211,153,.10)}
  .err{border-color:rgba(255,90,90,.30);background:rgba(255,90,90,.10)}
  .alertLine{display:flex;gap:10px;align-items:flex-start}
  .ico{
    width:24px;height:24px;border-radius:10px;
    display:grid;place-items:center;
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,90,90,.18);
    flex:0 0 auto;
  }
  .spin{
    width:16px;height:16px;border-radius:99px;
    border:2px solid rgba(255,255,255,.25);
    border-top-color: rgba(255,255,255,.95);
    display:inline-block;
    animation:rot .7s linear infinite;
    vertical-align:-3px;
    margin-right:8px;
  }
  @keyframes rot{to{transform:rotate(360deg)}}
</style>
</head>

<body>
<div class="wrap">
  <div class="topbar">
    <div class="brand">
      <div class="logo">
        <img src="https://ramruay365.co/wp-content/uploads/2025/12/1735020594-1.png" alt="RR365">
      </div>
      <div class="t">
        <b>Rumruay365</b>
        <span>‡∏ó‡∏≤‡∏¢‡∏ú‡∏•‡∏ö‡∏≠‡∏• ‚Ä¢ ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</span>
      </div>
    </div>
    <div class="chip">
      <span class="dot"></span>
      <span id="rr365Status">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
    </div>
  </div>

  <section class="card">
    <div class="head">
      <div class="heroLogo">
        <div class="pill">
          <img src="https://ramruay365.co/wp-content/uploads/2025/12/1735020594-1.png" alt="‡∏£‡πà‡∏≥‡∏£‡∏ß‡∏¢365">
        </div>
      </div>

      <h2 class="title">‡∏ó‡∏≤‡∏¢‡∏ú‡∏•‡∏ö‡∏≠‡∏• (‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥)</h2>
      <div class="sub">
        ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô: ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå ‚Üí ‚Äú‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‚Äù (‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß) ‚Üí ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‚Üí ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏ó‡∏≤‡∏¢‡πÑ‡∏î‡πâ<br>
        <span id="closeText"></span>
      </div>

      <div class="matchBar">
        <div class="teams">
          <div>
            <div class="badge"><img id="homeLogo" alt="‡∏ó‡∏µ‡∏°‡πÄ‡∏´‡∏¢‡πâ‡∏≤"></div>
            <div class="teamName" id="homeName">‚Äî</div>
          </div>
          <div class="vs">VS</div>
          <div>
            <div class="badge"><img id="awayLogo" alt="‡∏ó‡∏µ‡∏°‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô"></div>
            <div class="teamName" id="awayName">‚Äî</div>
          </div>
        </div>
        <div class="hint" style="margin-top:10px">
          ‡∏Ñ‡∏π‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: <b id="matchText">‚Äî</b> ‚Ä¢ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <b id="stText">NONE</b>
        </div>
      </div>
    </div>

    <div class="body">
      <form id="f" autocomplete="off">
        <div class="row">
          <div class="label">
            <span>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</span>
            <span class="mini">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á: <b id="devMini">‚Äî</b></span>
          </div>

          <!-- ‚úÖ FIX: type=tel ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ WP/‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå -->
          <input class="input" id="user" type="tel" inputmode="numeric" autocomplete="tel"
                 placeholder="‡πÄ‡∏ä‡πà‡∏ô 096xxxxxxx" required>

          <div class="btns">
            <button type="button" class="btn btnGhost" id="btnReq">üßæ ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)</button>
            <button type="button" class="btn btnGhost" id="btnStatus">üîÑ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
            <button type="reset"  class="btn btnGhost" id="btnReset">‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤</button>
          </div>

          <div class="hint">
            * ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å 1 ‡∏Ñ‡∏ô / 1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏ö‡∏≠‡∏£‡πå = ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ñ‡∏≤‡∏ß‡∏£)
          </div>
        </div>

        <div class="row">
          <div class="label">
            <span>‡∏ó‡∏≤‡∏¢‡∏™‡∏Å‡∏≠‡∏£‡πå (‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç)</span>
            <span class="mini">‡∏ó‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</span>
          </div>

          <div class="scoreBox">
            <div class="scoreCtrl">
              <button type="button" class="scBtn" id="hsMinus">‚àí</button>
              <input class="scoreInput" id="hs" type="number" value="0" min="0" max="99" readonly disabled>
              <button type="button" class="scBtn" id="hsPlus">+</button>
            </div>

            <div class="vs" style="font-size:16px">VS</div>

            <div class="scoreCtrl">
              <button type="button" class="scBtn" id="asMinus">‚àí</button>
              <input class="scoreInput" id="as" type="number" value="0" min="0" max="99" readonly disabled>
              <button type="button" class="scBtn" id="asPlus">+</button>
            </div>
          </div>

          <div class="btns">
            <button class="btn btnPrimary" id="btnSend" type="submit" disabled>‚õî ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
          </div>
        </div>

        <div id="msg"></div>
      </form>
    </div>
  </section>
</div>

<script>
  /* ================== CONFIG (‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ) ================== */
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxxiUEJbHuXxat2AUJNl8wm5k_rh9wtapqt9R2TUHn0zHdpgus8yq6JRjpd_l7CzaJWiA/exec";

  const HOME_TEAM_NAME = "‡∏™‡πÄ‡∏õ‡∏≠‡∏£‡πå‡∏™";
  const AWAY_TEAM_NAME = "‡∏•‡∏¥‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏û‡∏π‡∏•";
  const ADMIN_CLOSE_TEXT = "‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ó‡∏≤‡∏¢: ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ 23:59 ‡∏ô.";

  const HOME_LOGO = "https://media.api-sports.io/football/teams/47.png";
  const AWAY_LOGO = "https://media.api-sports.io/football/teams/40.png";
  /* ========================================================= */

  const $ = (id)=>document.getElementById(id);

  function showMsg(type, text){
    const cls = (type==="ok") ? "alert ok" : "alert err";
    const ico = (type==="ok") ? "‚úÖ" : "‚ö†Ô∏è";
    $("msg").innerHTML = `
      <div class="${cls}">
        <div class="alertLine">
          <div class="ico">${ico}</div>
          <div>${text}</div>
        </div>
      </div>`;
    $("rr365Status").textContent = (type==="ok") ? "‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" : "‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö";
  }

  function isValidPhone(p){ return /^0\\d{8,9}$/.test(p); }

  // ===== deviceId ‡∏ú‡∏π‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ñ‡∏≤‡∏ß‡∏£ =====
  function getDeviceId(){
    const key="RR365_DEVICE_ID";
    let v=localStorage.getItem(key);
    if(!v){
      v=(crypto && crypto.randomUUID) ? crypto.randomUUID()
        : ("dev_"+Math.random().toString(16).slice(2)+Date.now());
      localStorage.setItem(key,v);
    }
    return v;
  }
  const deviceId=getDeviceId();
  $("devMini").textContent = deviceId.slice(0,8)+"‚Ä¶";

  // ‚úÖ FIX: ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏ö‡∏≠‡∏£‡πå (‡∏Å‡∏±‡∏ô‡πÇ‡∏î‡∏ô disable/overlay ‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å WP)
  function forceEnablePhoneInput(){
    const u = $("user");
    if(!u) return;
    u.disabled = false;
    u.readOnly = false;
    u.style.pointerEvents = "auto";
    u.style.userSelect = "text";
    u.style.webkitUserSelect = "text";
  }
  setTimeout(forceEnablePhoneInput, 0);
  window.addEventListener("pageshow", forceEnablePhoneInput);
  document.addEventListener("visibilitychange", ()=>{ if(!document.hidden) forceEnablePhoneInput(); });

  // ===== local lock: ‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ã‡πâ‡∏≥ (‡∏ù‡∏±‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö) =====
  const LS_REQ_KEY  = "RR365_REQ_SENT_" + deviceId;
  const LS_USER_KEY = "RR365_LAST_USER_" + deviceId;

  function hasRequestedLocally(){ return localStorage.getItem(LS_REQ_KEY) === "1"; }
  function setRequestedLocally(username){
    localStorage.setItem(LS_REQ_KEY, "1");
    localStorage.setItem(LS_USER_KEY, username);
  }

  // ===== set match UI =====
  $("homeLogo").src = HOME_LOGO;
  $("awayLogo").src = AWAY_LOGO;
  $("homeName").textContent = HOME_TEAM_NAME;
  $("awayName").textContent = AWAY_TEAM_NAME;
  $("matchText").textContent = `${HOME_TEAM_NAME} vs ${AWAY_TEAM_NAME}`;
  $("closeText").textContent = ADMIN_CLOSE_TEXT;

  $("homeLogo").onerror=function(){this.onerror=null; this.src="https://ramruay365.co/wp-content/uploads/2025/12/1735020594-1.png";}
  $("awayLogo").onerror=function(){this.onerror=null; this.src="https://ramruay365.co/wp-content/uploads/2025/12/1735020594-1.png";}

  // ===== spinner (+/-) =====
  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
  function changeScore(id, step){
    const el=$(id);
    if(el.disabled) return;
    const min = Number(el.min || 0);
    const max = Number(el.max || 99);
    let v = parseInt(el.value || "0", 10);
    if(Number.isNaN(v)) v = 0;
    el.value = String(clamp(v + step, min, max));
  }

  function lockScoreUI(disabled){
    $("hs").disabled = disabled;
    $("as").disabled = disabled;
    $("hsMinus").disabled = disabled;
    $("hsPlus").disabled  = disabled;
    $("asMinus").disabled = disabled;
    $("asPlus").disabled  = disabled;
  }

  $("hsMinus").addEventListener("click", ()=>changeScore("hs",-1));
  $("hsPlus").addEventListener("click",  ()=>changeScore("hs", 1));
  $("asMinus").addEventListener("click", ()=>changeScore("as",-1));
  $("asPlus").addEventListener("click",  ()=>changeScore("as", 1));

  function setStatus(st){
    $("stText").textContent = st;

    if(st === "APPROVED"){
      lockScoreUI(false);
      $("btnSend").disabled=false;
      $("btnSend").textContent="‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ó‡∏≤‡∏¢";
      $("btnReq").disabled=true;
      $("btnReq").textContent="üßæ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡πâ‡∏ß (‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á‡∏ã‡πâ‡∏≥)";
      forceEnablePhoneInput(); // ‡∏¢‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå/‡πÅ‡∏Å‡πâ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ (‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ ‡∏ö‡∏≠‡∏Å‡πÑ‡∏î‡πâ)
      return;
    }

    if(st === "USED"){
      lockScoreUI(true);
      $("btnSend").disabled=true;
      $("btnSend").textContent="‚úÖ ‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏•‡πâ‡∏ß";
      $("user").disabled=true;         // USED ‡∏ñ‡∏∂‡∏á‡∏Ñ‡πà‡∏≠‡∏¢‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå
      $("btnReq").disabled=true;
      $("btnStatus").disabled=true;
      return;
    }

    if(st === "PENDING"){
      lockScoreUI(true);
      $("btnSend").disabled=true;
      $("btnSend").textContent="‚õî ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥";
      $("btnReq").disabled=true;
      $("btnReq").textContent="üßæ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡πâ‡∏ß (‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á‡∏ã‡πâ‡∏≥)";
      forceEnablePhoneInput();
      return;
    }

    // REJECTED / NONE / BLOCKED
    lockScoreUI(true);
    $("btnSend").disabled=true;
    $("btnSend").textContent="‚õî ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥";
    forceEnablePhoneInput();

    if(hasRequestedLocally()){
      $("btnReq").disabled=true;
      $("btnReq").textContent="üßæ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡πâ‡∏ß (‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á‡∏ã‡πâ‡∏≥)";
    }else{
      $("btnReq").disabled=false;
      $("btnReq").textContent="üßæ ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)";
    }
  }

  async function post(body){
    const res = await fetch(WEB_APP_URL, {
      method:"POST",
      headers: {"Content-Type":"text/plain;charset=utf-8"},
      body: JSON.stringify(body)
    });
    const t = await res.text();
    return JSON.parse(t);
  }

  function setLoading(btn, on, text){
    if(on){
      btn.dataset.prev = btn.textContent;
      btn.disabled = true;
      btn.innerHTML = `<span class="spin"></span>${text || "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£..."}`;
    }else{
      btn.disabled = false;
      btn.textContent = btn.dataset.prev || btn.textContent;
    }
  }

  // init local
  (function initLocal(){
    const lastUser = localStorage.getItem(LS_USER_KEY) || "";
    if(lastUser) $("user").value = lastUser;

    if(hasRequestedLocally()){
      $("btnReq").disabled = true;
      $("btnReq").textContent = "üßæ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡πâ‡∏ß (‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á‡∏ã‡πâ‡∏≥)";
    }
  })();

  // init
  setStatus("NONE");

  // ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
  $("btnReq").addEventListener("click", async ()=>{
    const username = $("user").value.trim();
    if(!isValidPhone(username)) return showMsg("err","‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô 096xxxxxxx)");
    if(!WEB_APP_URL || WEB_APP_URL.includes("‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå")) return showMsg("err","‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà WEB_APP_URL");

    if(hasRequestedLocally()){
      return showMsg("err","‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á‡∏ã‡πâ‡∏≥) ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞");
    }

    setLoading($("btnReq"), true, "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠...");
    try{
      const data = await post({action:"request", username, deviceId, userAgent:navigator.userAgent});

      if(data.ok){
        showMsg("ok", data.msg);
        setRequestedLocally(username);
        setStatus(data.status || "PENDING");
      }else{
        const st = data.status || "";
        if(String(data.msg||"").includes("‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á‡∏ã‡πâ‡∏≥") || st==="PENDING" || st==="APPROVED" || st==="USED"){
          setRequestedLocally(username);
          $("btnReq").disabled = true;
          $("btnReq").textContent = "üßæ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡πâ‡∏ß (‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á‡∏ã‡πâ‡∏≥)";
        }
        showMsg("err", data.msg || "‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        if(st) setStatus(st);
      }
    }catch(e){
      showMsg("err","‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Web App / Deploy / ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï");
    }finally{
      if(!hasRequestedLocally()){
        setLoading($("btnReq"), false);
        $("btnReq").textContent="üßæ ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)";
      }
    }
  });

  // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  $("btnStatus").addEventListener("click", async ()=>{
    const username = $("user").value.trim();
    if(!isValidPhone(username)) return showMsg("err","‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
    if(!WEB_APP_URL || WEB_APP_URL.includes("‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå")) return showMsg("err","‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà WEB_APP_URL");

    setLoading($("btnStatus"), true, "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡πá‡∏Ñ...");
    try{
      const data = await post({action:"status", username, deviceId, userAgent:navigator.userAgent});
      if(data.ok){
        showMsg("ok", data.msg);
        setRequestedLocally(username);
        setStatus(data.status || "PENDING");
      }else{
        showMsg("err", data.msg || "‡πÄ‡∏ä‡πá‡∏Ñ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        setStatus(data.status || "NONE");
      }
    }catch(e){
      showMsg("err","‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    }finally{
      setLoading($("btnStatus"), false);
      $("btnStatus").textContent="üîÑ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞";
    }
  });

  // ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ó‡∏≤‡∏¢ (‡∏ï‡πâ‡∏≠‡∏á APPROVED ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
  $("f").addEventListener("submit", async (e)=>{
    e.preventDefault();

    const username = $("user").value.trim();
    if(!isValidPhone(username)) return showMsg("err","‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
    if(!WEB_APP_URL || WEB_APP_URL.includes("‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå")) return showMsg("err","‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà WEB_APP_URL");

    setLoading($("btnSend"), true, "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...");
    try{
      const data = await post({
        action:"submit",
        username,
        deviceId,
        homeScore: $("hs").value,
        awayScore: $("as").value,
        userAgent: navigator.userAgent
      });

      if(data.ok){
        showMsg("ok", data.msg);
        setStatus("USED");
      }else{
        showMsg("err", data.msg || "‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        if(data.status === "USED") setStatus("USED");
        else {
          $("btnSend").disabled = false;
          $("btnSend").textContent = "‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ó‡∏≤‡∏¢";
        }
      }
    }catch(e){
      showMsg("err","‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Web App / Deploy / ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï");
      $("btnSend").disabled=false;
      $("btnSend").textContent="‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ó‡∏≤‡∏¢";
    }
  });

  // reset (‡πÑ‡∏°‡πà‡∏•‡πâ‡∏≤‡∏á‡∏•‡πá‡∏≠‡∏Å request ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á‡∏ã‡πâ‡∏≥)
  $("btnReset").addEventListener("click", ()=>{
    setTimeout(()=>{ $("msg").innerHTML=""; forceEnablePhoneInput(); },0);
  });
</script>
</body>
</html>
